/*! jQuery ColorInput - v0.1.0 - 2012-12-16
* https://github.com/KaptinLin/colorInput
* Copyright (c) 2012 KaptinLin; Licensed GPL */
(function(e,t,n,r){"use strict";var i="colorInput",s=function(e){return e?(e.length===3&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),e.length===6?e:null):null},o={RGB:{match:/rgb\(\s*(\d{1,3}%?)\s*,\s*(\d{1,3}%?)\s*,\s*(\d{1,3}%?)\s*\)/,parse:function(e){return{r:e[1].substr(-1)==="%"?parseInt(e[1].slice(0,-1)*2.55,10):parseInt(e[1],10),g:e[2].substr(-1)==="%"?parseInt(e[2].slice(0,-1)*2.55,10):parseInt(e[2],10),b:e[3].substr(-1)==="%"?parseInt(e[3].slice(0,-1)*2.55,10):parseInt(e[3],10)}},to:function(e){return"rgb("+e.r+","+e.g+","+e.b+")"}},RGBA:{match:/rgba\(\s*(\d{1,3}%?)\s*,\s*(\d{1,3}%?)\s*,\s*(\d{1,3}%?)\s*,\s*(\d?(?:\.\d+)?)\s*\)/,parse:function(e){return{r:e[1].substr(-1)==="%"?parseInt(e[1].slice(0,-1)*2.55,10):parseInt(e[1],10),g:e[2].substr(-1)==="%"?parseInt(e[2].slice(0,-1)*2.55,10):parseInt(e[2],10),b:e[3].substr(-1)==="%"?parseInt(e[3].slice(0,-1)*2.55,10):parseInt(e[3],10),a:parseFloat(e[4])}},to:function(e){return"rgba("+e.r+","+e.g+","+e.b+","+e.a+")"}},HSL:{match:/hsl\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*\)/,parse:function(e){var t={h:(e[1]%360+360)%360,s:parseFloat(e[2]/100),l:parseFloat(e[3]/100)};return u.HSLToRGB(t)},to:function(e){var t=u.RGBToHSL(e);return"hsl("+parseInt(t.h,10)+","+Math.round(t.s*100)+"%,"+Math.round(t.l*100)+"%)"}},HSLA:{match:/hsla\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d?(?:\.\d+)?)\s*\)/,parse:function(e){var t={h:(e[1]%360+360)%360,s:parseFloat(e[2]/100),l:parseFloat(e[3]/100),a:parseFloat(e[4])};return u.HSLToRGB(t)},to:function(e){var t=u.RGBToHSL(e);return"hsla("+parseInt(t.h,10)+","+Math.round(t.s*100)+"%,"+Math.round(t.l*100)+"%,"+e.a+")"}},HEX:{match:/#([a-f0-9]{6}|[a-f0-9]{3})/,parse:function(e){var t=e[1];return t.length===3&&(t=s(t)),{r:parseInt(t.substr(0,2),16),g:parseInt(t.substr(2,2),16),b:parseInt(t.substr(4,2),16)}},to:function(e){var t=[e.r.toString(16),e.g.toString(16),e.b.toString(16)];return n.each(t,function(e,n){n.length===1&&(t[e]="0"+n)}),"#"+t.join("")}},TRANSPARENT:{match:/transparent/,parse:function(e){return{r:0,g:0,b:0,a:0}},to:function(e){return"transparent"}}},u=n.colorValue=function(e,t){this.value={r:0,g:0,b:0,h:0,s:0,v:0,a:1},this._format="HEX",this.init(e,t)};u.prototype={constructor:u,init:function(e,t,n){this.onChange=typeof n=="function"?n:function(){};if(typeof t!="undefined")this.format(t);else for(var r in o){var i=null;if((i=o[r].match.exec(e))!=null){this.format(r);break}}this.from(e)},from:function(e,t){if(typeof e=="string"){var n=null;for(var r in o)if((n=o[r].match.exec(e))!=null){this.set(o[r].parse(n));break}}else typeof e=="object"&&this.set(e)},format:function(e){if(typeof e!="string"||!(e=e.toUpperCase())||typeof o[e]=="undefined")return this._format;e!=="TRANSPARENT"&&(this._format=e)},toRGBA:function(){return o.RGBA.to(this.value)},toRGB:function(){return o.RGB.to(this.value)},toHSLA:function(){return o.HSLA.to(this.value)},toHSL:function(){return o.HSL.to(this.value)},toHEX:function(){return o.HEX.to(this.value)},toString:function(){return this.value.a===0?o.TRANSPARENT.to(this.value):o[this.format()].to(this.value)},get:function(){return this.value},set:function(e){var t=0,n=0;for(var r in e)"hsv".indexOf(r)!==-1?(n++,this.value[r]=e[r]):"rgb".indexOf(r)!==-1?(t++,this.value[r]=e[r]):r==="a"&&(this.value.a=e.a);if(t>n){var i=u.RGBtoHSV(this.value);this.value.r===0&&this.value.g===0&&this.value.b===0?this.value.h=e.h:this.value.h=i.h,this.value.s=i.s,this.value.v=i.v}else if(n>t){var s=u.HSVtoRGB(this.value);this.value.r=s.r,this.value.g=s.g,this.value.b=s.b}}},u.HSLToRGB=function(e){var t=e.h/360,n=e.s,r=e.l,i,s;r<=.5?s=r*(n+1):s=r+n-r*n,i=r*2-s;var o={r:u.hueToRGB(i,s,t+1/3),g:u.hueToRGB(i,s,t),b:u.hueToRGB(i,s,t-1/3)};return typeof e.a!="undefined"&&(o.a=e.a),e.l===0&&(o.h=e.h),o},u.hueToRGB=function(e,t,n){var r;return n<0?n+=1:n>1&&(n-=1),n*6<1?r=e+(t-e)*n*6:n*2<1?r=t:n*3<2?r=e+(t-e)*(2/3-n)*6:r=e,Math.round(r*255)},u.RGBToHSL=function(e){var t=e.r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),s=Math.max(t,n,r),o=s-i,u=s+i,a=u*.5,f,l;return i===s?f=0:t===s?f=60*(n-r)/o+360:n===s?f=60*(r-t)/o+120:f=60*(t-n)/o+240,o===0?l=0:a<=.5?l=o/u:l=o/(2-u),{h:Math.round(f)%360,s:l,l:a}},u.RGBToHEX=function(e){return o.HEX.to(e)},u.HSLToHEX=function(e){var t=u.HSLToRGB(e);return o.HEX.to(t)},u.HSVtoHEX=function(e){var t=u.HSVtoRGB(e);return o.HEX.to(t)},u.RGBtoHSV=function(e){var t=e.r/255,n=e.g/255,r=e.b/255,i=Math.max(t,n,r),s=Math.min(t,n,r),o,u,a=i,f=i-s;u=i===0?0:f/i;if(i===s)o=0;else{switch(i){case t:o=(n-r)/f+(n<r?6:0);break;case n:o=(r-t)/f+2;break;case r:o=(t-n)/f+4}o/=6}return{h:o*360,s:u,v:a}},u.HSVtoRGB=function(e){var t,n,r,i=e.h%360/60,s=e.s,o=e.v,u=o*s,a=u*(1-Math.abs(i%2-1));return t=n=r=o-u,i=~~i,t+=[u,a,0,0,a,u][i],n+=[a,u,u,a,0,0][i],r+=[0,0,a,u,u,a][i],{r:Math.round(t*255),g:Math.round(n*255),b:Math.round(r*255)}};var a=n.colorInput=function(e,t){this.input=e,this.$input=n(e),this.$picker=n("<div>");var r=[];n.each(this.$input.data(),function(e,t){var n=new RegExp("^color","i");n.test(e)&&(r[e.toLowerCase().replace(n,"")]=t)}),this.options=n.extend(!0,{},a.defaults,t,r),this.components=n.extend(!0,{},this.components);for(var i in this.components)typeof this.options.components[i]!="undefined"&&this.options.components[i]===!1&&delete this.components[i];this.options.format||(this.options.format=this.options.format||"hex"),this.input.value===""?this.color=new u({r:255,g:255,b:255,a:1},this.options.format):this.color=new u(this.input.value,this.options.format),this.created=!1,this.create()};a.prototype={constructor:a,components:{},create:function(){this.created=!0,this.$picker=n(this.options.template.picker);for(var e in this.components)this.components[e].init(this);this.$input.addClass("colorinput");var t=this;this.$input.on({"focus.colorinput":function(){t.show()},"keydown.colorinput":function(e){e.keyCode===9?t.hide():e.keyCode===13&&(t.color.from(t.$input.val()),t.update({},"input"),t.hide())},"keyup.colorinput":function(){t.color.from(t.$input.val()),t.update({},"input")}}),(this.options.readonly||this.$input.prop("readonly"))&&this.readonly(!0),(this.options.disabled||this.$input.prop("disabled"))&&this.disabled(!0)},destroy:function(){this.created=!1,this.hide();for(var e in this.components)this.components[e].destroy(this);this.$picker.remove(),this.$input.removeClass("colorinput").removeData().off(".colorinput")},update:function(e,t){var r=this;e!=={}&&r.color.set(e),n.each(r.components,function(e,n){t!==e&&n.update.call(n,r)}),t!=="input"&&r.$input.val(r.color.toString())},show:function(){if(this.$input.prop("disabled"))return!1;var r=this;this.$picker.parent().length===0&&this.$picker.appendTo("body").on("mousedown.colorinput",function(e){e.stopPropagation();var t=n(e.target),i=t.closest(".colorinput-picker > div");n.each(r.components,function(t,n){if(i.is(n.selector)&&typeof n.mousedown=="function")return e.preventDefault(),n.mousedown(r,e)})}),this.place(),this.$picker.show(),n(t).on("mousedown.colorinput",function(e){if(n(e.target).is(r.$input))return;return r.hide(),!1}),n(e).on("resize.colorinput",n.proxy(this.place,this))},hide:function(){this.$picker.hide(),this.$input.blur(),n(t).off("mousedown.colorinput"),n(e).off("resize.colorinput")},place:function(){var t=!this.$input.is(":visible"),r=t?this.$trigger.offset():this.$input.offset(),i=t?this.$trigger.outerHeight():this.$input.outerHeight(),s=t?this.$trigger.outerWidth():this.$input.outerWidth()+this.$trigger.outerWidth(),o=this.$picker.outerWidth(),u=this.$picker.outerHeight(),a,f;u+r.top>n(e).height()+n(e).scrollTop()?a=r.top-u:a=r.top+i,o+r.left>n(e).width()+n(e).scrollLeft()?f=r.left-o+s:f=r.left,this.$picker.css({top:a,left:f})},readonly:function(e){return this.created&&this.$input.prop("readonly",e),this},disabled:function(e){return this.created&&this.$input.prop("disabled",e),e?this.$picker.addClass("is-disabled"):this.$picker.removeClass("is-disabled"),this},value:function(e){if(!e)return this.color.toString();this.color.from(e),this.update()},opacity:function(e){if(!e)return this.color.value.a;this.update({a:e})}},a.registerComponent=function(e,t){a.prototype.components[e]=t},a.registerComponent("trigger",{selector:".colorinput-trigger",template:'<span class="colorinput-trigger"><span></span></span>',init:function(e){e.$trigger=n(this.template),this.$trigger_inner=e.$trigger.children("span"),e.$trigger.insertAfter(e.$input),e.$trigger.on({click:n.proxy(e.show,e)}),this.update(e)},update:function(e){this.$trigger_inner.css("backgroundColor",e.color.toRGBA())},destroy:function(e){e.$trigger.remove()}}),a.registerComponent("saturation",{selector:".colorinput-picker-saturation",template:'<div class="colorinput-picker-saturation"><i><b></b></i></div>',width:150,height:150,size:6,data:{},init:function(e){this.$saturation=n(this.template).appendTo(e.$picker),this.$handle=this.$saturation.children("i"),this.update(e)},mousedown:function(e,r){var i=this.$saturation.offset();return this.data.startY=r.pageY,this.data.startX=r.pageX,this.data.top=r.pageY-i.top,this.data.left=r.pageX-i.left,this.move(e,this.data.left,this.data.top),this.mousemove=function(t){t.stopPropagation(),t.preventDefault();var n=this.data.left+(t.pageX||this.data.startX)-this.data.startX,r=this.data.top+(t.pageY||this.data.startY)-this.data.startY;return this.move(e,n,r),!1},this.mouseup=function(e){return e.stopPropagation(),e.preventDefault(),n(t).off({mousemove:this.mousemove,mouseup:this.mouseup}),!1},n(t).on({mousemove:n.proxy(this.mousemove,this),mouseup:n.proxy(this.mouseup,this)}),!1},move:function(e,t,n,r){n=Math.max(0,Math.min(this.height,n)),t=Math.max(0,Math.min(this.width,t)),this.$handle.css({top:n-this.size,left:t-this.size}),r!==!1&&e.update({s:t/this.width,v:1-n/this.height},"saturation")},update:function(e){this.$saturation.css("backgroundColor",u.HSLToHEX({h:e.color.value.h,s:1,l:.5}));var t=e.color.value.s*this.width,n=(1-e.color.value.v)*this.height;this.move(e,t,n,!1)},destroy:function(e){n(t).off({mousemove:this.mousemove,mouseup:this.mouseup})}}),a.registerComponent("hue",{selector:".colorinput-picker-hue",template:'<div class="colorinput-picker-hue"><i></i></div>',height:150,data:{},init:function(e){this.$hue=n(this.template).appendTo(e.$picker),this.$handle=this.$hue.children("i"),this.update(e)},mousedown:function(e,r){var i=this.$hue.offset();return this.data.startY=r.pageY,this.data.top=r.pageY-i.top,this.move(e,this.data.top),this.mousemove=function(t){t.stopPropagation(),t.preventDefault();var n=this.data.top+(t.pageY||this.data.startY)-this.data.startY;return this.move(e,n),!1},this.mouseup=function(e){return e.stopPropagation(),e.preventDefault(),n(t).off({mousemove:this.mousemove,mouseup:this.mouseup}),!1},n(t).on({mousemove:n.proxy(this.mousemove,this),mouseup:n.proxy(this.mouseup,this)}),!1},move:function(e,t,n,r){t=Math.max(0,Math.min(this.height,t)),typeof n=="undefined"&&(n=(1-t/this.height)*360),n=Math.max(0,Math.min(360,n)),this.$handle.css({top:t,background:u.HSVtoHEX({h:n,s:1,v:1})}),r!==!1&&e.update({h:n},"hue")},update:function(e){var t=e.color.value.h===0?0:this.height*(1-e.color.value.h/360);this.move(e,t,e.color.value.h,!1)},destroy:function(e){n(t).off({mousemove:this.mousemove,mouseup:this.mouseup})}}),a.registerComponent("alpha",{selector:".colorinput-picker-alpha",template:'<div class="colorinput-picker-alpha"><i></i></div>',height:150,data:{},init:function(e){this.$alpha=n(this.template).appendTo(e.$picker),this.$handle=this.$alpha.children("i"),this.update(e)},mousedown:function(e,r){var i=this.$alpha.offset();return this.data.startY=r.pageY,this.data.top=r.pageY-i.top,this.move(e,this.data.top),this.mousemove=function(t){t.stopPropagation(),t.preventDefault();var n=this.data.top+(t.pageY||this.data.startY)-this.data.startY;return this.move(e,n),!1},this.mouseup=function(e){return e.stopPropagation(),e.preventDefault(),n(t).off({mousemove:this.mousemove,mouseup:this.mouseup}),!1},n(t).on({mousemove:n.proxy(this.mousemove,this),mouseup:n.proxy(this.mouseup,this)}),!1},move:function(e,t,n,r){t=Math.max(0,Math.min(this.height,t)),typeof n=="undefined"&&(n=1-t/this.height),n=Math.max(0,Math.min(1,n)),this.$handle.css({top:t}),r!==!1&&e.update({a:Math.round(n*100)/100},"alpha")},update:function(e){var t=this.height*(1-e.color.value.a);this.$alpha.css("backgroundColor",e.color.toHEX()),this.move(e,t,e.color.value.a,!1)},destroy:function(e){n(t).off({mousemove:this.mousemove,mouseup:this.mouseup})}}),a.registerComponent("extra",{selector:".colorinput-picker-extra",template:'<div class="colorinput-picker-extra"><ul class="colorinput-picker-sets"><li data-color="white">white</li><li data-color="black">black</li><li data-color="transparent">transparent</li></ul><ul class="colorinput-picker-info"><li><label>R:<input type="text" data-type="r"/></label></li><li><label>G:<input type="text" data-type="g"/></label></li><li><label>B:<input type="text" data-type="b"/></label></li><li><label>A:<input type="text" data-type="a"/></label></li></ul><input type="text" class="colorinput-picker-hex" /><div class="colorinput-picker-preview"><div></div></div></div>',height:150,data:{},init:function(e){this.$extra=n(this.template),this.$extra.$r=this.$extra.find('[data-type="r"]'),this.$extra.$g=this.$extra.find('[data-type="g"]'),this.$extra.$b=this.$extra.find('[data-type="b"]'),this.$extra.$a=this.$extra.find('[data-type="a"]'),this.$extra.$hex=this.$extra.find(".colorinput-picker-hex"),this.$extra.$preview=this.$extra.find(".colorinput-picker-preview div"),this.$extra.find(".colorinput-picker-sets").delegate("li","click",function(t){var r={},i=n(t.target).data("color");switch(i){case"white":r={r:255,g:255,b:255,a:1};break;case"black":r={r:0,g:0,b:0,a:1};break;case"transparent":r={r:255,g:255,b:255,a:0}}e.value(r),e.hide()}),this.$extra.find(".colorinput-picker-info").delegate("input","change",function(t){var r,i=n(t.target).data("type");switch(i){case"r":case"g":case"b":r=parseInt(this.value,10),r>255?r=255:r<0&&(r=0);break;case"a":r=parseFloat(this.value,10),r>1?r=1:r<0&&(r=0)}var s={};s[i]=r,e.value(s)}),this.$extra.$hex.on("change",function(){e.value(this.value)}),this.update(e),this.$extra.appendTo(e.$picker)},update:function(e){this.$extra.$r.val(e.color.value.r),this.$extra.$g.val(e.color.value.g),this.$extra.$b.val(e.color.value.b),this.$extra.$a.val(e.color.value.a),this.$extra.$hex.val(e.color.toHEX()),this.$extra.$preview.css("backgroundColor",e.color.toRGBA())}}),a.defaults={disabled:!1,readonly:!1,format:null,components:{saturation:!0,hue:!0,alpha:!0,extra:!0},template:{picker:'<div class="colorinput-picker"></div>'}},n.fn.colorInput=function(e){if(typeof e=="string"){var t=e,s=arguments.length>1?Array.prototype.slice.call(arguments,1):r;return this.each(function(){var e=n.data(this,i);typeof e[t]=="function"&&e[t].apply(e,s)})}return this.each(function(){n.data(this,i)||n.data(this,i,new a(this,e))})}})(window,document,jQuery);